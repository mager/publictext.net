<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
</head>
<body>



<div class="blueboard product-demo"><div class="wrapper"><h3 class="context-demo">SimpleGeo Context Demo</h3><div class="demo-aside"><div class="demo-aside-inner"><h4>SimpleGeo Context provides relevant contextual information such as geographic boundaries, weather, and demographics for a specific location.</h4><h4 class="instructions">Instructions</h4><p>Click anywhere on the map to view the SimpleGeo Context for that point. After the features have loaded you can view the polygon for specific features by clicking on the category.</p><a href="/signup/" class="get-an-api-key-dark">Get an api key</a><div class="docs-top-buttons"><a href="http://simplegeo.com/docs/api-endpoints/simplegeo-context" class="view-the-docs-dark">View the docs</a><a href="#top" class="back-to-the-top">Back to the top</a></div></div><span class="tlp"></span><span class="blp"></span></div><div class="demo-aside demo-aside-results"><div class="demo-aside-inner"><h4 class="features">Features</h4><ul id="infolist"></ul></div><span class="trp"></span><span class="brp"></span></div><div class="demo-frame room-for-results"><div class="demo-frame-inner"><span class="tlp"></span><span class="trp"></span><span class="blp"></span><span class="brp"></span><div class="demo-map-wrapper"><div class="demo-map"><div class="the-map"></div><span class="tlp"></span><span class="trp"></span><span class="blp"></span><span class="brp"></span><div class="shade-tlc"></div><div class="shade-blc"></div><div class="shade-trc"></div><div class="shade-brc"></div><div class="shade-right"></div><div class="shade-left"></div><div class="shade-top"></div><div class="shade-bottom"></div></div></div></div><span class="tlp"></span><span class="trp"></span><span class="blp"></span><span class="brp"></span></div><span class="osmcopy">

        Maptiles &copy; 2011
        <a href="http://www.cloudmade.com/">CloudMade</a>,
        <a href="http://www.openstreetmap.org/">OpenStreetMap</a> contributors,
        <a href="http://creativecommons.org/licenses/by-sa/2.0/">CCBYSA</a>.
      </span><div class="clear"></div></div></div></div><div class="footer-shadow"></div><div class="footer"><div class="wrapper"><div class="wrapper-inner"><span class="copy">&copy; 2011 SimpleGeo, Inc.</span><a href="/">Home</a><a href="/company/">Company</a><a href="/press/">Press</a><a href="/contact/">Contact</a><a href="http://help.simplegeo.com/">Help &amp; Support</a><a href="/docs/">Documentation</a><a href="/signup/">Sign Up / Login</a><a href="/page/privacy-policy.html">Privacy Policy</a><a href="/page/terms-of-service.html">TOS</a></div></div></div><div class="modal-shade"></div><script type="text/javascript">var _gaq = _gaq || [];</script><script type="text/javascript" src="/static/CACHE/js/4c67b134f593.js" charset="utf-8"></script><script src="http://cdn.simplegeo.com/js/latest/simplegeo.context.jq.min.js"></script><script type="text/javascript" src="/static/js/polymaps.js"></script><script type="text/javascript">
$(document).ready(function(){
if(!!document.createElementNS && !!document.createElementNS('http://www.w3.org/2000/svg', "svg").createSVGRect) {
  var client = new simplegeo.ContextClient('FmTByqYrt6SyNRBVyeA6gj5FvW7jTjJN');

  var po = org.polymaps;
  var map = po.map()
      .container($(".the-map")[0].appendChild(po.svg("svg")))
      .add(po.interact());

  var icons = {
      marker: function() {
        var path = po.svg("path");
        path.setAttribute("class", "map-poi");
        path.setAttribute("transform", "translate(-16,-28)");
        path.setAttribute("d", "M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z");
        return path;
      }
    };

  map.add(po.image()
      .url(po.url("http://{S}tile.cloudmade.com"
      + "/1a1b06b230af4efdbb989ea99e9841af" // http://cloudmade.com/register
      + "/998/256/{Z}/{X}/{Y}.png")
      .hosts(["a.", "b.", "c.", ""])));
  var clicked_point = [];
  var geojson = po.geoJson();
  map.add(geojson);
  map.add(po.compass().pan("none"));
  geojson.on("load", function(e) {
      var r = 20 * Math.pow(2, e.tile.zoom - 12);
      for (var i = 0; i < e.features.length; i++) {
        var f = e.features[i],
            c = f.element;
        if (e.features[i].data.geometry.type=="Point") {
          if(e.features[i].data.geometry.meta=="Text Center") {
            g = f.element = po.svg("text");
            g.appendChild(document.createTextNode(e.features[i].data.properties.name));
            g.setAttribute("class", "shadow");
            g.setAttribute("transform", c.getAttribute("transform"));
            g2 = po.svg("text");
            g2.appendChild(document.createTextNode(e.features[i].data.properties.name));
            g2.setAttribute("class","foreground");
            g2.setAttribute("transform", c.getAttribute("transform"));
            c.parentNode.appendChild(g2);
            c.parentNode.replaceChild(g, c);
          } else {
            g = f.element = po.svg("g");
            g.appendChild(icons.marker());
            g.setAttribute("transform", c.getAttribute("transform"));
            g.setAttribute("style","cursor:pointer;");
            g.setAttribute("id", f.data.id);
            c.parentNode.replaceChild(g, c);
          }
        } else {
          e.features[i].element.setAttribute("class", "boundary")
          e.features[i].element.appendChild(po.svg("title").appendChild(
                    document.createTextNode(e.features[i].data.properties.name))
                    .parentNode);
        }
      }
  });
  var mousePosition;
  
  client.getLocation(function(err, position) {
    if (!err) {
      clicked_point = [position.coords.longitude, position.coords.latitude];
      $("#infolist").html($("<li>Loading...</li>").addClass("loading"));
      geojson.features([]);
      map.add(geojson.features([{geometry: {coordinates: clicked_point, type: "Point"}}]))
      map.center({lon: position.coords.longitude, lat: position.coords.latitude});
      client.getContext(position.coords.latitude, position.coords.longitude,  function(err, data) {
          if (err) 
              (typeof console == "undefined") ? alert(err) : console.error(err);
          else {
              data.features.sort(function(a, b) {
                  return approximateArea(a.bounds) - approximateArea(b.bounds);
              });
              listFeatures(data);
          }
      });
      
    }
  })
  
  $(".the-map").mousedown(function(e) { mousePosition = map.mouse(e); });
  $(".the-map").mouseup(function(e) {
    var position = map.mouse(e);
    if (Math.abs(mousePosition.x - position.x + mousePosition.y - position.y) > 5) return;
    var coord = map.pointLocation(map.mouse(e));
    while (coord.lon > 180.0) coord.lon -= 360.0;
    while (coord.lon < -180.0) coord.lon += 360.0;
    clicked_point = [coord.lon, coord.lat];
    $("#infolist").html($("<li>Loading...</li>").addClass("loading"));
    _gaq.push(['_trackEvent', 'Demo', 'Context', coord.lat+", "+coord.lon]);
    geojson.features([]);
    map.add(geojson.features([{geometry: {coordinates: clicked_point, type: "Point"}}]))
    map.center({lon: clicked_point[0], lat: clicked_point[1]});
    client.getContext(coord.lat, coord.lon,  function(err, data) {
        if (err) 
            (typeof console == "undefined") ? alert(err) : console.error(err);
        else {
            data.features.sort(function(a, b) {
                return approximateArea(a.bounds) - approximateArea(b.bounds);
            });
            listFeatures(data);
        }
    });
  });
  
  function approximateArea(bounds) {
      var delta = bounds[3] - bounds[1];
      return (bounds[2]-bounds[0])*Math.cos(delta*Math.PI/180.0)*delta;
  }
  function getWeather(weather) {
      var temp = "";
      if (!weather) return;
      if (weather.temperature) {
          var temp_f = weather.temperature.substr(0, weather.temperature.length-1);
          var temp_c = Math.round((temp_f - 32) / 9.0 * 5.0);
          temp = temp_c + "&deg;C (" + temp_f + "&deg;F)";
      }
      return (weather.conditions ? weather.conditions + " " : "") + temp;
  }
  function addInfoItem(innerHtml) {
      var li = document.createElement("li");
      li.innerHTML = innerHtml;
      $("#infolist").append(li);
  }
  function listFeatures(result) {
      $("#infolist").empty();
  
      var extent = map.extent();
      var bounds = [extent[0].lon, extent[0].lat, extent[1].lon, extent[1].lat];
  
      var weather = getWeather(result.weather);
      // if (weather)
      //     addInfoItem("<div class=\"feature_name temperature\">" + weather + "</div>" +
      //                 "<div class=\"feature_type temperature\">Weather Conditions</div>");
  
      $.each(result.features, function(i, f) {
        if (i <= 16) {
          var li = document.createElement("li"),
              anchor = document.createElement("a");
          anchor.addEventListener("click", function(e) {loadFeature(anchor,f)}, false);
          $.each(f.classifiers, function(j, cl) {
              var cat = cl.category;
              var tooltip = $("<span/>").addClass("tooltip");
              tooltip
                .append($("<span/>")
                    .addClass("tooltip-inner")
                    .append(f.name)
                    .append($("<span/>").addClass("tlp"))
                    .append($("<span/>").addClass("trp"))
                    .append($("<span/>").addClass("blp"))
                    .append($("<span/>").addClass("brp")))
                .append($("<span/>").addClass("carat"));
              $(anchor).append(cat);
              $(anchor).append(tooltip);
          });
          $(li).append($("<a/>").attr("href","/"+f.handle+"/").addClass("sg-link"));
          li.appendChild(anchor);
          $("#infolist").append(li);
        }
      });
  }

  function loadFeature(anchor, feature) {
      $(".feature_clicked").each(function (i, e) {e.className = "feature_clickable"});
      anchor.parentNode.className = "feature_clicked";
      var z=map.zoom(),
          w=Math.log(360/(feature.bounds[2]-feature.bounds[0]))/Math.log(2),
          h=Math.log(180/(feature.bounds[3]-feature.bounds[1]))/Math.log(2);
      var zoom=Math.max(w,h);
      _gaq.push(['_trackEvent', 'Demo', 'Context Get Feature', feature.handle]);
      client.getFeature(feature.handle, {zoom: parseInt(zoom)}, function (err, data) {
          if (err) {
              (typeof console == "undefined") ? alert(err) : console.error(err);
          } else {
              geojson.features([
                data,
                { properties:data.properties, geometry: {coordinates: [(feature.bounds[0]+feature.bounds[2])/2,(feature.bounds[1]+feature.bounds[3])/2], type: "Point", meta:"Text Center"}},
                { geometry: {coordinates: clicked_point, type: "Point"}}
              ]);
              map.center({lon: clicked_point[0], lat: clicked_point[1]});
              map.zoom(zoom);
          }
      });
  }
} else {
  $(".product-demo, .check-out-demo").hide();
}
});

</script><script type="text/javascript">
    var _sf_async_config={uid:11250,domain:"simplegeo.com"};
    (function(){
      function loadChartbeat() {
        window._sf_endpt=(new Date()).getTime();
        var e = document.createElement('script');
        e.setAttribute('language', 'javascript');
        e.setAttribute('type', 'text/javascript');
        e.setAttribute('src',
           (("https:" == document.location.protocol) ? "https://s3.amazonaws.com/" : "http://") +
           "static.chartbeat.com/js/chartbeat.js");
        document.body.appendChild(e);
      }
      var oldonload = window.onload;
      window.onload = (typeof window.onload != 'function') ?
         loadChartbeat : function() { oldonload(); loadChartbeat(); };
    })();
    </script></body></html>

